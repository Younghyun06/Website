<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Journey — My Story</title>
  <!-- Leaflet CSS (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="site-title">Journey</h1>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="journey.html">Journey</a>
        <a href="resume.html">Resume</a>
        <a href="research.html">Research</a>
      </nav>
    </div>
  </header>
  <main class="container">
    <h2>From Korea to the United States</h2>
    <p>Explore the map below to see what I was doing in each city during different years.</p>

    <div class="journey-layout">
      <figure class="map-figure">
        <div id="map" class="map" role="region" aria-label="Interactive map of journey locations" tabindex="0"></div>
        <figcaption class="map-caption">Use the markers or the list to explore each place. Buttons are keyboard accessible.</figcaption>
      </figure>
      <aside class="map-panel" id="map-panel">
        <h3 id="panel-title">Select a location</h3>
        <div id="panel-content">Click a marker or a city from the list to see details.</div>
        <ul id="location-list" class="location-list"></ul>
      </aside>
    </div>
  </main>
  <footer class="site-footer"><div class="container">&copy; <span id="year2"></span> — Journey</div></footer>
  <!-- Leaflet JS (CDN) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Set year immediately
    document.getElementById('year2').textContent = new Date().getFullYear();

    // Wrap initialization so we can check Leaflet is available and DOM is ready
    function initJourneyMap(){
      if(typeof L === 'undefined'){
        const panel = document.getElementById('panel-content');
        if(panel) panel.textContent = 'Map failed to load — Leaflet library not available.';
        console.error('Leaflet (L) not found.');
        return;
      }

      // Data-driven locations (easy to extend)
      const locations = [
        {
          id: 'seoul',
          title: 'Seoul, South Korea',
          coords: [37.5665, 126.9780],
          zoom: 12,
          content: '<p>Grew up and attended school in Seoul.</p><p>Years: —</p>'
        },
        {
          id: 'denver',
          title: 'Denver, Colorado, USA',
          coords: [39.7392, -104.9903],
          zoom: 12,
          content: '<p>Studied in Denver from 2022–2023.</p>'
        },
        {
          id: 'baton_rouge',
          title: 'Baton Rouge, Louisiana, USA',
          coords: [30.4515, -91.1871],
          zoom: 12,
          content: '<p>Started research in Baton Rouge in 2024.</p>'
        },
        {
          id: 'los_angeles',
          title: 'Los Angeles, California, USA',
          coords: [34.0522, -118.2437],
          zoom: 12,
          content: '<p>Visited / worked in Los Angeles.</p>'
        }
      ];

      // Initialize map
      const map = L.map('map', {scrollWheelZoom: false}).setView([20,0], 2);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      const markers = {};

      // Add markers and list items
      const listEl = document.getElementById('location-list');
      locations.forEach(loc => {
        const marker = L.marker(loc.coords).addTo(map).bindPopup(`<strong>${loc.title}</strong><br/>${loc.content}`);
        marker.on('click', () => showLocation(loc));
        markers[loc.id] = marker;

        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.className = 'loc-button';
        btn.textContent = loc.title;
        // Accessibility attributes for the button
        btn.setAttribute('aria-controls', 'map-panel');
        btn.setAttribute('aria-expanded', 'false');
        btn.setAttribute('data-loc', loc.id);

        btn.onclick = () => {
          // smooth fly to
          map.flyTo(loc.coords, loc.zoom, {duration: 1.2});
          marker.openPopup();
          showLocation(loc);
        };
        li.appendChild(btn);
        listEl.appendChild(li);
      });

      function showLocation(loc){
        document.getElementById('panel-title').textContent = loc.title;
        document.getElementById('panel-content').innerHTML = loc.content;
        // Open the popup if the marker exists
        if(markers[loc.id]){
          markers[loc.id].openPopup();
        }
        // Manage aria-expanded on location buttons
        document.querySelectorAll('.loc-button').forEach(b => b.setAttribute('aria-expanded', 'false'));
        const active = document.querySelector(`.loc-button[data-loc="${loc.id}"]`);
        if(active) active.setAttribute('aria-expanded', 'true');
      }
    }

    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', initJourneyMap);
    } else {
      initJourneyMap();
    }
  </script>
</body>
</html>